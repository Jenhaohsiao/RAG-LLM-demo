# ğŸš€ Qdrant RAG æ•´åˆæŒ‡å—

## ğŸ“‹ ç›®éŒ„
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [å‰ç½®æº–å‚™](#å‰ç½®æº–å‚™)
3. [è¨­ç½® Qdrant é›²ç«¯è³‡æ–™åº«](#è¨­ç½®-qdrant-é›²ç«¯è³‡æ–™åº«)
4. [é…ç½®ç’°å¢ƒè®Šæ•¸](#é…ç½®ç’°å¢ƒè®Šæ•¸)
5. [æº–å‚™æ–‡å­—æª”æ¡ˆ](#æº–å‚™æ–‡å­—æª”æ¡ˆ)
6. [åŸ·è¡Œ Embedding å’Œä¸Šå‚³](#åŸ·è¡Œ-embedding-å’Œä¸Šå‚³)
7. [æ¸¬è©¦æ‡‰ç”¨ç¨‹å¼](#æ¸¬è©¦æ‡‰ç”¨ç¨‹å¼)
8. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)

---

## æ¦‚è¿°

æœ¬å°ˆæ¡ˆç¾åœ¨æ•´åˆäº†çœŸæ­£çš„ RAG (Retrieval-Augmented Generation) ç³»çµ±ï¼š

- **å‘é‡è³‡æ–™åº«**: Qdrant Cloud
- **Embedding æ¨¡å‹**: Google Gemini text-embedding-004 (768 ç¶­åº¦)
- **LLM**: Google Gemini 2.0 Flash
- **å·¥ä½œæµç¨‹**: æ–‡å­— â†’ åˆ†å¡Š â†’ Embedding â†’ Qdrant â†’ æª¢ç´¢ â†’ LLM å›ç­”

---

## å‰ç½®æº–å‚™

### 1. å·²å®‰è£çš„ä¾è³´
```bash
# ç¢ºèªå·²å®‰è£ä»¥ä¸‹å¥—ä»¶
@qdrant/qdrant-js  # Qdrant å®¢æˆ¶ç«¯
uuid               # ç”Ÿæˆå”¯ä¸€ ID
tsx                # åŸ·è¡Œ TypeScript è…³æœ¬
```

### 2. éœ€è¦çš„ API é‡‘é‘°
- âœ… Google Gemini API Key
- âœ… Qdrant Cloud API Key å’Œ URL

---

## è¨­ç½® Qdrant é›²ç«¯è³‡æ–™åº«

### æ­¥é©Ÿ 1: è¨»å†Š Qdrant Cloud

1. å‰å¾€ [Qdrant Cloud](https://cloud.qdrant.io/)
2. é»æ“Š "Get Started" è¨»å†Šå¸³è™Ÿ
3. å®Œæˆè¨»å†Šå¾Œç™»å…¥

### æ­¥é©Ÿ 2: å‰µå»ºé›†ç¾¤ (Cluster)

1. åœ¨ Dashboard é»æ“Š "Create Cluster"
2. é¸æ“‡æ–¹æ¡ˆï¼š
   - **å…è²»æ–¹æ¡ˆ**: 1GB å„²å­˜ç©ºé–“ï¼Œè¶³å¤ æ¸¬è©¦ä½¿ç”¨
   - **ä»˜è²»æ–¹æ¡ˆ**: æ ¹æ“šéœ€æ±‚é¸æ“‡
3. é¸æ“‡å€åŸŸï¼ˆå»ºè­°é¸æ“‡é›¢æ‚¨æœ€è¿‘çš„å€åŸŸï¼‰
4. é»æ“Š "Create"

### æ­¥é©Ÿ 3: ç²å–é€£æ¥è³‡è¨Š

1. é›†ç¾¤å‰µå»ºå®Œæˆå¾Œï¼Œé»æ“Šé›†ç¾¤åç¨±
2. åœ¨ "API" æ¨™ç±¤é ä¸­æ‰¾åˆ°ï¼š
   - **Cluster URL**: é¡ä¼¼ `https://xxxxx.qdrant.io`
   - **API Key**: é»æ“Š "Create API Key" ç”Ÿæˆ

ğŸ“ **é‡è¦**: è¤‡è£½ä¸¦ä¿å­˜é€™äº›è³‡è¨Šï¼Œç¨å¾Œéœ€è¦ä½¿ç”¨ï¼

---

## é…ç½®ç’°å¢ƒè®Šæ•¸

### æ­¥é©Ÿ 1: å‰µå»º `.env.local` æª”æ¡ˆ

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å‰µå»º `.env.local` æª”æ¡ˆï¼š

```bash
# è¤‡è£½ç¯„ä¾‹æª”æ¡ˆ
copy .env.example .env.local
```

### æ­¥é©Ÿ 2: å¡«å…¥ API é‡‘é‘°

ç·¨è¼¯ `.env.local` æª”æ¡ˆï¼Œå¡«å…¥æ‚¨çš„é‡‘é‘°ï¼š

```env
# Gemini API Configuration
VITE_API_KEY=AIza...ä½ çš„Gemini_API_Key

# Qdrant Cloud Configuration
VITE_QDRANT_URL=https://xxxxx.qdrant.io
VITE_QDRANT_API_KEY=ä½ çš„_Qdrant_API_Key
```

### é©—è­‰é…ç½®

ç¢ºä¿ï¼š
- âœ… æ²’æœ‰å¤šé¤˜çš„ç©ºæ ¼
- âœ… URL ä»¥ `https://` é–‹é ­
- âœ… API Key å®Œæ•´è¤‡è£½

---

## æº–å‚™æ–‡å­—æª”æ¡ˆ

### æ­¥é©Ÿ 1: æº–å‚™ 5 å€‹æ–‡å­—æª”æ¡ˆ

åœ¨ `data/` ç›®éŒ„ä¸­æ”¾å…¥æ‚¨çš„æ–‡å­—æª”æ¡ˆï¼š

```
data/
â”œâ”€â”€ book1.txt
â”œâ”€â”€ book2.txt
â”œâ”€â”€ book3.txt
â”œâ”€â”€ book4.txt
â””â”€â”€ book5.txt
```

### æª”æ¡ˆæ ¼å¼è¦æ±‚

- **æ”¯æ´æ ¼å¼**: `.txt` æˆ– `.md`
- **ç·¨ç¢¼**: UTF-8
- **å»ºè­°å¤§å°**: æ¯å€‹æª”æ¡ˆ 1KB - 10MB
- **å‘½å**: ä½¿ç”¨è‹±æ–‡å’Œåº•ç·šï¼Œä¾‹å¦‚ `the_great_gatsby.txt`

### æª”æ¡ˆå…§å®¹ç¯„ä¾‹

```text
æ›¸åï¼šç¯„ä¾‹å°èªª

ç¬¬ä¸€ç« ï¼šé–‹å§‹

é€™æ˜¯ç¬¬ä¸€ç« çš„å…§å®¹ã€‚ä¸»è§’åœ¨ä¸€å€‹æ™´æœ—çš„æ—©æ™¨é†’ä¾†...

ç¬¬äºŒç« ï¼šç™¼å±•

æ•…äº‹ç¹¼çºŒç™¼å±•...
```

### æ­¥é©Ÿ 2: æ›´æ–° constants.ts

ç·¨è¼¯ `constants.ts`ï¼Œç¢ºä¿æ›¸ç± ID èˆ‡æª”æ¡ˆåç¨±å°æ‡‰ï¼š

```typescript
export const BOOKS: Book[] = [
  {
    id: 'book1',  // å°æ‡‰ book1.txt
    title: 'æ›¸å 1',
    author: 'ä½œè€…å',
    // ... å…¶ä»–è¨­å®š
  },
  // ... å…¶ä»–æ›¸ç±
];
```

---

## åŸ·è¡Œ Embedding å’Œä¸Šå‚³

### æ­¥é©Ÿ 1: åŸ·è¡Œè™•ç†è…³æœ¬

åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œï¼š

```bash
npm run process-books
```

### æ­¥é©Ÿ 2: è§€å¯Ÿè™•ç†éç¨‹

è…³æœ¬æœƒé¡¯ç¤ºé€²åº¦ï¼š

```
ğŸš€ é–‹å§‹è™•ç†æ–‡å­—æª”æ¡ˆä¸¦ä¸Šå‚³åˆ° Qdrant
============================================================

ğŸ“š è®€å–æ–‡å­—æª”æ¡ˆ...
ğŸ“– è®€å–æª”æ¡ˆ: book1.txt (5234 å­—ç¬¦)
ğŸ“– è®€å–æª”æ¡ˆ: book2.txt (4521 å­—ç¬¦)
...

âœ… æ‰¾åˆ° 5 å€‹æª”æ¡ˆ

ğŸ—„ï¸  åˆå§‹åŒ– Qdrant é›†åˆ...
âœ… é›†åˆ "books_collection" å·²å­˜åœ¨

ğŸ”„ è™•ç†æ›¸ç±: æ›¸å 1
  ğŸ“ åˆ†å‰²æ–‡æœ¬...
  âœ… åˆ†å‰²æˆ 12 å€‹å¡Š
  ğŸ§  ç”Ÿæˆ embeddings...
  é€²åº¦: 12/12 (100%)
  âœ… Embeddings ç”Ÿæˆå®Œæˆ

ğŸ’¾ ä¸Šå‚³å‘é‡åˆ° Qdrant...
  âœ… å·²ä¸Šå‚³ 100/150
  âœ… å·²ä¸Šå‚³ 150/150

ğŸ“Š ç²å–çµ±è¨ˆä¿¡æ¯...
============================================================
âœ… è™•ç†å®Œæˆï¼
============================================================
ğŸ“š æ›¸ç±æ•¸é‡: 5
ğŸ“ æ–‡æœ¬å¡Šæ•¸: 150
ğŸ—„ï¸  å‘é‡æ•¸é‡: 150
ğŸ“Š è³‡æ–™é»æ•¸: 150
âœ… ç‹€æ…‹: green
============================================================

ğŸ‰ æ‰€æœ‰è³‡æ–™å·²æˆåŠŸä¸Šå‚³åˆ° Qdrantï¼
```

### é æœŸè™•ç†æ™‚é–“

- **æ¯å€‹æ–‡æœ¬å¡Š**: ç´„ 0.5-1 ç§’ï¼ˆåŒ…å« API èª¿ç”¨å»¶é²ï¼‰
- **5 å€‹æª”æ¡ˆï¼ˆç´„ 150 å¡Šï¼‰**: ç´„ 2-3 åˆ†é˜

---

## æ¸¬è©¦æ‡‰ç”¨ç¨‹å¼

### æ­¥é©Ÿ 1: å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
npm run dev
```

### æ­¥é©Ÿ 2: æ¸¬è©¦ RAG åŠŸèƒ½

1. æ‰“é–‹ç€è¦½å™¨å‰å¾€ `http://localhost:5173`
2. é¸æ“‡ä¸€æœ¬æ›¸
3. è¼¸å…¥å•é¡Œï¼Œä¾‹å¦‚ï¼š
   - "é€™æœ¬æ›¸çš„ä¸»è§’æ˜¯èª°ï¼Ÿ"
   - "è«‹ç¸½çµç¬¬ä¸€ç« çš„å…§å®¹"
   - "é€™å€‹æ•…äº‹çš„ä¸»é¡Œæ˜¯ä»€éº¼ï¼Ÿ"

### æ­¥é©Ÿ 3: æª¢æŸ¥ Console

æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œæª¢æŸ¥ Console è¼¸å‡ºï¼š

```
âœ… Qdrant å®¢æˆ¶ç«¯å·²åˆå§‹åŒ–
âœ… Retrieved 5 relevant chunks from Qdrant
```

### é©—è­‰ RAG å·¥ä½œ

æˆåŠŸçš„ RAG ç³»çµ±æœƒï¼š
- âœ… æ ¹æ“šæ‚¨çš„å•é¡Œæª¢ç´¢ç›¸é—œå…§å®¹
- âœ… å›ç­”åŸºæ–¼æª¢ç´¢åˆ°çš„å¯¦éš›æ–‡æœ¬å…§å®¹
- âœ… é¡¯ç¤ºç›¸é—œæ€§åˆ†æ•¸ï¼ˆåœ¨ console ä¸­ï¼‰

---

## å¸¸è¦‹å•é¡Œ

### Q1: åŸ·è¡Œ `npm run process-books` æ™‚å‡ºç¾éŒ¯èª¤

**éŒ¯èª¤**: `Qdrant URL å’Œ API Key å¿…é ˆåœ¨ç’°å¢ƒè®Šæ•¸ä¸­è¨­ç½®`

**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ `.env.local` æª”æ¡ˆæ˜¯å¦å­˜åœ¨
2. ç¢ºèªç’°å¢ƒè®Šæ•¸åç¨±æ­£ç¢ºï¼š
   - `VITE_QDRANT_URL`
   - `VITE_QDRANT_API_KEY`
3. é‡æ–°å•Ÿå‹•çµ‚ç«¯æ©Ÿ

### Q2: Qdrant é€£æ¥å¤±æ•—

**éŒ¯èª¤**: `Failed to connect to Qdrant`

**æª¢æŸ¥æ¸…å–®**:
- [ ] Qdrant Cluster æ˜¯å¦æ­£åœ¨é‹è¡Œï¼ˆåœ¨ Qdrant Dashboard æª¢æŸ¥ç‹€æ…‹ï¼‰
- [ ] URL æ˜¯å¦æ­£ç¢ºï¼ˆåŒ…å« `https://`ï¼‰
- [ ] API Key æ˜¯å¦æœ‰æ•ˆ
- [ ] ç¶²çµ¡é€£æ¥æ˜¯å¦æ­£å¸¸

### Q3: Embedding ç”Ÿæˆå¤±æ•—

**éŒ¯èª¤**: `ç„¡æ³•ç”Ÿæˆ embedding`

**å¯èƒ½åŸå› **:
1. Gemini API Key ç„¡æ•ˆæˆ–éæœŸ
2. API é…é¡ç”¨ç›¡
3. æ–‡æœ¬éé•·ï¼ˆè¶…éæ¨¡å‹é™åˆ¶ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**:
1. é©—è­‰ Gemini API Key
2. æª¢æŸ¥ [API é…é¡](https://aistudio.google.com/app/apikey)
3. èª¿æ•´ `chunkSize` åƒæ•¸ï¼ˆåœ¨ `embeddingService.ts` ä¸­ï¼‰

### Q4: æ‰¾ä¸åˆ°ç›¸é—œå…§å®¹

**ç¾è±¡**: AI å›ç­” "No relevant content found"

**åŸå› **:
1. è³‡æ–™å°šæœªä¸Šå‚³åˆ° Qdrant
2. å•é¡Œèˆ‡æ›¸ç±å…§å®¹ä¸ç›¸é—œ
3. æ›¸ç± ID ä¸åŒ¹é…

**è§£æ±ºæ–¹æ¡ˆ**:
1. é‡æ–°åŸ·è¡Œ `npm run process-books`
2. æª¢æŸ¥ `constants.ts` ä¸­çš„æ›¸ç± ID
3. å˜—è©¦æ›´å…·é«”çš„å•é¡Œ

### Q5: è™•ç†é€Ÿåº¦å¤ªæ…¢

**å„ªåŒ–å»ºè­°**:
1. æ¸›å°‘ `topK` åƒæ•¸ï¼ˆæª¢ç´¢æ›´å°‘çš„æ–‡æœ¬å¡Šï¼‰
2. å¢åŠ æ–‡æœ¬å¡Šå¤§å°ï¼ˆæ¸›å°‘ç¸½å¡Šæ•¸ï¼‰
3. ä½¿ç”¨æ‰¹æ¬¡è™•ç†ï¼ˆå·²å¯¦ç¾ï¼‰

### Q6: å¦‚ä½•åˆªé™¤ä¸¦é‡æ–°ä¸Šå‚³è³‡æ–™ï¼Ÿ

```bash
# æ–¹æ³• 1: åœ¨ Qdrant Dashboard ä¸­åˆªé™¤é›†åˆ

# æ–¹æ³• 2: ä½¿ç”¨ç¨‹å¼ç¢¼
# åœ¨ processAndUpload.ts ä¸­æ·»åŠ ï¼š
await deleteBookVectors('book_id');

# ç„¶å¾Œé‡æ–°åŸ·è¡Œ
npm run process-books
```

---

## é€²éšé…ç½®

### èª¿æ•´æ–‡æœ¬åˆ†å¡Šå¤§å°

ç·¨è¼¯ `embeddingService.ts`:

```typescript
export const smartSplitText = (
  text: string,
  maxChunkSize: number = 1000  // èª¿æ•´é€™å€‹å€¼
): string[] => {
  // ...
}
```

### èª¿æ•´æª¢ç´¢æ•¸é‡

ç·¨è¼¯ `geminiService.ts`:

```typescript
const retrievedContext = await retrieveRelevantContext(
  currentMessage,
  selectedBook.id,
  5  // èª¿æ•´ç‚º 3-10 ä¹‹é–“
);
```

### ç›£æ§ Qdrant ä½¿ç”¨æƒ…æ³

1. ç™»å…¥ [Qdrant Dashboard](https://cloud.qdrant.io/)
2. é¸æ“‡æ‚¨çš„é›†ç¾¤
3. æŸ¥çœ‹ï¼š
   - å„²å­˜ç©ºé–“ä½¿ç”¨é‡
   - API è«‹æ±‚æ•¸é‡
   - å‘é‡æ•¸é‡

---

## æ¶æ§‹åœ–

```
ç”¨æˆ¶è¼¸å…¥
   â†“
[Embedding Service] â†’ ç”ŸæˆæŸ¥è©¢å‘é‡
   â†“
[Qdrant Service] â†’ æœç´¢ç›¸ä¼¼å‘é‡ (Top-K)
   â†“
æª¢ç´¢ç›¸é—œæ–‡æœ¬å¡Š
   â†“
[Gemini Service] â†’ åŸºæ–¼æª¢ç´¢å…§å®¹ç”Ÿæˆå›ç­”
   â†“
è¿”å›çµ¦ç”¨æˆ¶
```

---

## æª”æ¡ˆçµæ§‹

```
RAG-LLM-demo/
â”œâ”€â”€ data/                          # ğŸ“š æ–‡å­—æª”æ¡ˆç›®éŒ„
â”‚   â”œâ”€â”€ book1.txt
â”‚   â”œâ”€â”€ book2.txt
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ qdrantService.ts          # ğŸ—„ï¸  Qdrant è³‡æ–™åº«æœå‹™
â”‚   â”œâ”€â”€ embeddingService.ts       # ğŸ§  Embedding ç”Ÿæˆæœå‹™
â”‚   â””â”€â”€ geminiService.ts          # ğŸ¤– LLM æœå‹™ï¼ˆå·²æ•´åˆ RAGï¼‰
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ processAndUpload.ts       # ğŸ“¤ è™•ç†å’Œä¸Šå‚³è…³æœ¬
â””â”€â”€ .env.local                    # ğŸ” ç’°å¢ƒè®Šæ•¸ï¼ˆä¸è¦æäº¤ï¼ï¼‰
```

---

## æˆæœ¬ä¼°ç®—

### Gemini API
- **Embedding**: text-embedding-004 å…è²»ï¼ˆæœ‰é…é¡é™åˆ¶ï¼‰
- **LLM**: gemini-2.0-flash-exp å…è²»ï¼ˆæœ‰é…é¡é™åˆ¶ï¼‰

### Qdrant Cloud
- **å…è²»æ–¹æ¡ˆ**: 1GB å„²å­˜ï¼Œç´„å¯å­˜å„² 100-200 æœ¬ä¸­ç­‰å¤§å°çš„æ›¸ç±
- **ä»˜è²»æ–¹æ¡ˆ**: å¾ $25/æœˆèµ·

---

## ä¸‹ä¸€æ­¥

1. âœ… å®Œæˆæ‰€æœ‰è¨­ç½®
2. âœ… ä¸Šå‚³æ–‡å­—æª”æ¡ˆåˆ° Qdrant
3. âœ… æ¸¬è©¦ RAG åŠŸèƒ½
4. ğŸ¯ æ ¹æ“šå¯¦éš›ä½¿ç”¨èª¿æ•´åƒæ•¸
5. ğŸš€ æº–å‚™éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

---

## æ”¯æ´èˆ‡å”åŠ©

é‡åˆ°å•é¡Œï¼Ÿ
1. æŸ¥çœ‹æœ¬æ–‡æª”çš„[å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
2. æª¢æŸ¥ Console éŒ¯èª¤è¨Šæ¯
3. æŸ¥çœ‹ Qdrant Dashboard ç‹€æ…‹
4. ç¢ºèªæ‰€æœ‰ç’°å¢ƒè®Šæ•¸æ­£ç¢ºè¨­ç½®

---

**ğŸ‰ æ­å–œï¼æ‚¨å·²æˆåŠŸæ•´åˆçœŸæ­£çš„ RAG ç³»çµ±ï¼**
